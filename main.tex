\documentclass{article}

\usepackage[utf8]{inputenc}
% \usepackage[round]{natbib}
\usepackage[english]{babel}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{dsfont}
\usepackage{url}
\usepackage{hyperref}
\usepackage{tikz-cd}
\usepackage{mathpartir}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{color}

\mathtoolsset{showonlyrefs}

\newcommand{\todo}[1]{\textcolor{red}{#1}}

\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\theoremstyle{remark}
\newtheorem{remark}{Remark}
\theoremstyle{definition}
\newtheorem{definition}{Definition}

\begin{document}

\title{A model of dependent type theory in the category of locally cartesian closed categories}

\author{Martin E.\@ Bidlingmaier}

\maketitle

\begin{abstract}
  \todo{TODO}
\end{abstract}

\section{Introduction}

Locally cartesian closed (lcc) categories are natural categorical models of extensional dependent type theory \cite{lcc-categories-and-type-theory}:
Given some lcc category $\mathcal{C}$, one interprets
\begin{itemize}
  \item
    contexts $\Gamma$ as objects of $\mathcal{C}$;
  \item
    (simultaneous) substitutions from $\Delta$ to $\Gamma$ as morphisms $f : \Delta \rightarrow \Gamma$ in $\mathcal{C}$;
  \item
    types $\Gamma \vdash \sigma$ as morphisms $\sigma : \operatorname{dom} \sigma \rightarrow \Gamma$ in $\mathcal{C}$ with codomain $\Gamma$; and
  \item
    terms $\Gamma \vdash s : \sigma$ as sections $s : \Gamma \rightleftarrows \operatorname{dom} \sigma : \sigma$ to the interpretations of types.
\end{itemize}
A context extension $\Gamma.\sigma$ is interpret as the domain of $\sigma$, substitution in types $\Gamma \vdash \sigma$ along substitutions $f : \Delta \rightarrow \Gamma$ is interpreted as pullback
\begin{equation}
  \begin{tikzcd}
    \operatorname{dom} \sigma[f] \arrow[r] \arrow[d, "{\sigma[f]}"] \arrow[dr, phantom, near start, "\lrcorner"] & \operatorname{dom} \sigma \arrow[d, "\sigma"] \\
    \Delta \arrow[r, "f"] & \Gamma
  \end{tikzcd}
\end{equation}
and similarly for terms $\Gamma \vdash s : \sigma$.
In lcc categories, the pullback functors $f^* : \mathcal{C}_{/ \Gamma} \rightarrow \mathcal{C}_{/ \Delta}$ are part of adjunctions $\Sigma_f \dashv f^* \dashv \Pi_f$ which are used for interpreting $\mathbf{\Sigma}$-types and $\mathbf{\Pi}$-types.
For example, the interpretations of types $\Gamma \vdash \sigma$ and $\Gamma.\sigma \vdash \tau$ is a pair of morphisms $\Gamma.\sigma.\tau \xrightarrow{\tau} \Gamma.\sigma \xrightarrow{\sigma} \Gamma$, and then $\Gamma \vdash \mathbf{\Pi}_\sigma \, \tau$ is interpreted as $\Pi_\sigma(\tau)$, which is an object of $\mathcal{C}_{/ \Gamma}$, i.e.\@ a morphism into $\Gamma$.

However, there is a slight mismatch:
Syntactic substitution is functorial and commutes strictly with type formers, whereas pullback is generally only pseudo-functorial and preserves universal objects only up to isomorphism.
Here functoriality of substitution means that if one has a sequence $\mathcal{E} \xrightarrow{g} \Gamma \xrightarrow{f} \Delta$ of substitutions, then we have equalities $\sigma[g][f] = \sigma[gf]$ and $s[g][f] = s[gf]$, i.e.\@ substituting in succession yields the same result as substituting with the composition.
For pullback functors, however, we are only guaranteed a natural isomorphism $g^* \cong f^* \cong (g \circ f)^*$.
Similarly, in type theory we have $(\mathbf{\Pi}_\sigma \, \tau)[f] = \mathbf{\Pi}_{\sigma[f]} \, \tau[f^+]$ (where $f^+$ denotes the weakening of $f$ along $\sigma$), whereas for pullback functors there exist merely isomorphisms $f^*(\Pi_\sigma \, \tau) \cong \Pi_{f^*(\sigma)} \, (f^+)^*(\tau)$.

In response to these problems, several notions of models with strict pullback operations have been introduced, e.g.\@ categories with families (cwf) \cite{internal-type-theory}, and coherence techniques have been developed to ``strictify'' weak models such as lcc categories to obtain models with well-behaved substitution \cite{substitution-up-to-isomorphism,on-the-interpretation-of-type-theory-in-lcc-categories,the-local-universes-model}.
Thus to interpret dependent type theory in some lcc category $\mathcal{C}$, one first builds an equivalence $\mathcal{C} \simeq \mathcal{C}^s$ of lcc categories so that $\mathcal{C}^s$ can endowed with the structure of a strict model of type theory (say, cwf structure) and interprets type theory in $\mathcal{C}^s$.

In this paper, we construct cwf structure on the category of all lcc categories (as opposed to on some specific lcc category), and show how this cwf structure can be used to solve the original coherence problem.
A crucial aspect will be the concrete presentation of the category of lcc categories in terms of a 1-category:
The category of lcc categories is most naturally understood as a $(2, 1)$-category, where the invertible 2-cells are natural isomorphisms of lcc functors.
$(2, 1)$-categories are a special case of $(\infty, 1)$-categories, and as such are amenable to presentations in terms of model categories \todo{cite}.
Model categories are 1-categories equipped with structure that is used to encode higher categorical phenomena in 1-categorical terms.
The choice of presenting model category is not unique, and we will explore three model categories, all of which encode the same higher category of lcc categories:
First the category $\mathrm{Lcc}$ of lcc sketches (section \ref{sec:lcc-sketches}), then the category $\mathrm{sLcc}$ (section \ref{sec:strict-lcc-categories}) of strict lcc categories, and finally the category $\operatorname{Coa} \mathrm{sLcc}$ of algebraically cofibrant strict lcc categories (section \ref{sec:algebraically-cofibrant}).
We then show that $\operatorname{Coa} \mathrm{sLcc}$ admits cwf structure supporting unit, extensional equality, $\mathbf{\Pi}$ and $\mathbf{\Sigma}$ types (theorem \ref{th:lcc-supports-types}).

In which sense can the category of lcc categories be understood as a model of type theory?
First note that the classical interpretation of type theory in an lcc category $\mathcal{C}$ is essentially an interpretion in the slice categories of $\mathcal{C}$:
\begin{itemize}
  \item
    objects $\Gamma \in \operatorname{Ob} \mathcal{C}$ can be identified with slice categories $\mathcal{C}_{/ \Gamma}$;
  \item
    morphisms $f : \Delta \rightarrow \Gamma$ can be identified with lcc functors $f^* : \mathcal{C}_{/ \Gamma} \rightarrow \mathcal{C}_{/ \Delta}$ which commute with the pullback functors $\Gamma^* : \mathcal{C} \rightarrow \mathcal{C}_{/ \Gamma}$ and $\Delta^* : \mathcal{C} \rightarrow \mathcal{C}_{/ \Delta}$;
  \item
    morphisms $\sigma : \operatorname{dom} \sigma \rightarrow \Gamma$ with codomain $\Gamma$ can be identified with the objects of the slice categories $\mathcal{C}_{/ \Gamma}$; and
  \item
    sections $s : \Gamma \leftrightarrows \operatorname{dom} \sigma : \sigma$ can be identified with morphisms $1 \rightarrow \sigma^*(\sigma)$ in the slice category $\mathcal{C}_{/ \operatorname{dom} \sigma}$.
\end{itemize}
Removing all reference to the base category $\mathcal{C}$, we may now attempt to interpret
\begin{itemize}
  \item
    each context $\Gamma$ as a separate lcc category;
  \item
    a substitution from $\Delta$ to $\Gamma$ as an lcc functor $f : \Gamma \rightarrow \Delta$;
  \item
    types $\Gamma \vdash \sigma$ as objects $\sigma \in \operatorname{Ob} \Gamma$; and
  \item
    terms $\Gamma \vdash s : \sigma$ as morphisms $s : 1 \rightarrow \sigma$ from a terminal object $1$ to $\sigma$, where $1$ denotes a terminal object.
\end{itemize}
In the original interpretation, substitutions of types and terms was defined in terms of the lcc pullback functors $f^* : \mathcal{C}_{/ \Gamma} \rightarrow \mathcal{C}_{/ \Delta}$ along morphisms $f : \Delta \rightarrow \Gamma$.
In the new interpretation, $f$ is already an lcc functor, which we simply apply to objects and morphisms of lcc categories.
To avoid having to dualize twice, we introduce the notion of \emph{covariant cwf}, which is a category $\mathcal{C}$ whose opposite is equipped with cwf structure.
We refer to morphisms in a covariant cwf as \emph{cosubstitutions}.
Intuitively, substitutions $f : \Delta \rightarrow \Gamma$ in cwfs are given by assignments of terms in $\Delta$ to the variables of $\Gamma$; a cosubstitution $f : \Gamma \rightarrow \Delta$ can thus be understood as an interpretation of $\Gamma$'s variables as terms in context $\Delta$.
In line with the interpretion of cosubstitutions as lcc functors, we denote substitution of types and terms $\Gamma \vdash s : \sigma$ along a cosubstitution $f : \Gamma \rightarrow \Delta$ by function application, i.e.\@ $\Delta \vdash f(s) : f(\sigma)$.
To make our idea of an interpretation of dependent type theory precise, we should now construct a cwf structure on the category of lcc categories and show that it satisfies the required equalities.
Unfortunately this fails for very similar reason as the na√Øve interpretation of type theory in a fixed lcc category:
Like pullback functors, lcc functors preserve lcc structure only up to ismorphism and not necessarily up to equality.
Furthermore, the obvious choice for context extension along a type $\Gamma \vdash \sigma$, the slice category $\Gamma.\sigma = \Gamma_{/ \sigma}$, has the required universal property only in the 2-categorical sense:
The groupoid of lcc functors $f : \Gamma \rightarrow \Delta$ and terms $\Delta \vdash w : f(\sigma)$ with natural isomorphisms of lcc functors as morphisms is equivalent, but not isomorphic, to the groupoid of lcc functors $k : \Gamma_{/ \sigma} \rightarrow \Delta$ which commute with the pullback functor $\sigma^* : \Gamma \rightarrow \Gamma_{/ \sigma}$ and map the diagonal $\sigma \rightarrow \sigma \times \sigma$ in $\Gamma_{/ \sigma}$ to $w$.

\section{Lcc sketches}
\label{sec:lcc-sketches}

As outlined earlier, the solution to these problems is a suitable model categorical presentation of the $(2, 1)$-category of lcc categories.
As a preliminary step, we define a model category $\mathrm{Lcc}$ of locally cartesian closed (lcc) sketches, which presents the $(2, 1)$-category of lcc categories.
Intuitively, lcc sketches are categories in which certain diagrams are marked as supposed to have a certain universal property but not required to actually satisfy it.
Thus an lcc sketch comes with squares marked as pullback squares, with objects marked as terminal objects and diagrams marked as dependent products their evaluation maps, but none of these are required to actually satisfy the universal property.
However, lcc category can be identified with their underlying lcc sketches, which are given by marking all diagrams as having a certain universal property if and only if they actually satisfy it.
Because the morphisms in $\mathrm{Lcc}$ are defined as functors which preserve marking, lcc functors of lcc categories can be identified with morphisms of underlying sketches.

The model category structure of $\mathrm{Lcc}$ is set up such that its fibrant objects are precisely the lcc categories, and general lcc sketches are equivalent if and only if the lcc categories they generate by fibrant replacement are equivalent.
Thus $\mathrm{Lcc}$ can be seen as a model categorical presentation of the $(2, 1)$-category of lcc categories, lcc functors and their natural isomorphisms.

\begin{definition}[\cite{marked-objects} Definition 2.1]
  Let $\mathcal{C}$ be a category.
  Let $i : I \rightarrow \mathcal{C}$ be a functor from a small category $I$ to $\mathcal{C}$.
  An \emph{($i$-)marked object} is given by an object $X$ in $\mathcal{C}$ and a subfunctor $m_X$ of $\mathrm{Hom}(i(-), X) : I^\mathrm{op} \rightarrow \mathrm{Set}$.
  A map of the form $k : i(K) \rightarrow X$ is \emph{marked} if $k \in m_X(K)$.

  A morphism of $i$-marked objects is a marking-preserving morphism of underlying objects in $\mathcal{C}$, i.e.\@ a morphism $f : X \rightarrow Y$ such that the image of $m_X$ under postcomposition by $f$ is contained in $m_Y$.
  The category of $i$-marked objects is denoted by $\mathcal{M}^i$.
\end{definition}

The forgetful functor $U : \mathcal{C}^i \rightarrow \mathcal{C}$ has a left and right adjoint:
Its left adjoint $X \mapsto X^\flat$ is given by equipping an object $X$ of $\mathcal{C}$ with the minimal marking $m_{X^\flat} = \emptyset \subseteq \mathrm{Hom}(i(-), X)$, while the right adjoint $X \mapsto X^\sharp$ equips objects with their maximal marking $m_{X^\sharp} = \mathrm{Hom}(i(-), X)$.

In our application, $I$ contain diagrams corresponding to the shape of lcc structure.
The morphisms in $I$ are used to enforce that the domains of maps marked as evaluation maps are marked as pullback squares.

\begin{definition}
  The small subcategory $I_\mathrm{Lcc} \subseteq \mathrm{Cat}$ of \emph{lcc shapes} is given by the terminal category 
  \begin{equation}
    \mathrm{T} =
    \left\{
      \begin{tikzcd}
        t
      \end{tikzcd}
    \right\}
  \end{equation}
  consisting of a single object $t$, the free standing (non-commutative) square
  \begin{equation}
    \mathrm{Pb} =
    \left\{
      \begin{tikzcd}
        \cdot \arrow[d, "p_1"] \arrow[r, "p_2"] & \cdot \arrow[d, "f_2"] \\
        \cdot \arrow[r, "f_1"] & \cdot
      \end{tikzcd}
    \right\}
  \end{equation}
  and the diagram
  \begin{equation}
    \mathrm{Pi} =
    \left\{
      \begin{tikzcd}
        \cdot \arrow[ddr, bend right, "p_1"] \arrow[drr, bend left, "p_2"] \arrow[dr, "\varepsilon"] \\
        & \cdot \arrow[d, "g"] & \cdot \arrow[d, "f_2"] \\
        & \cdot \arrow[r, "f_1"] & \cdot
      \end{tikzcd}
    \right\}.
  \end{equation}
  The only non-trivial functor in $I_\mathrm{Lcc}$ is the inclusion $\mathrm{Pb} \subseteq \mathrm{Pi}$ given by the outer square of $\mathrm{Pi}$ as indicated by the variable names.

  We obtain the category $\mathrm{Cat}^{I_\mathrm{Lcc}}$ of \emph{lcc-marked categories}.
\end{definition}

Logical theories are usually defined as a pair of signature $\Sigma$ and a set of $\mathcal{T}$ of axioms over the signature $\Sigma$.
To define a notion of model, one then defines a structure which interprets the operations and relations in $\Sigma$, and then defines the models of $(\Sigma, \mathcal{T})$ to be those $\Sigma$-structures which satisfy the axioms $\mathcal{T}$.

Similarly, the model structure on the category of lcc-marked categories is defined in 2-step process:
First, a model structure corresponding to $\Sigma$-structures is constructed.
This model structure identifies lcc-marked categories if their choice of marking differs only within isomorphism classes.

Now suppose that $\mathcal{C} = \mathcal{M}$ is a model category.
Let $\gamma : \mathcal{M} \rightarrow \operatorname{Ho} \mathcal{M}$ be the canonical functor to the homotopy category.
A marking $m_X \subseteq \mathrm{Hom}(i(-), X)$ of some $X \in \operatorname{Ob} \mathcal{M}$ induces a canonical marking $\gamma(m_X) \subseteq \mathrm{Hom}(\gamma(i(-)), \gamma(X))$ on $\gamma(X)$ by taking $\gamma(m_X)$ to be the image of $m_X$ under $\gamma$.
Thus a morphism $K \rightarrow X$ in $\operatorname{Ho} \mathcal{M}$ is marked if and only if it has a preimage under $\gamma$ which is marked.
The assignment $(m_X, X) \mapsto (\gamma(m_X), \gamma(X))$ is functorial.

\begin{theorem}[\cite{marked-objects} Theorem 3.3]
  \label{th:marked-model-category}
  Let $\mathcal{M}$ be a combinatorial model category $\mathcal{M}$.
  Let $i : I \rightarrow \mathcal{M}$ be functor from a small category $I$ to $\mathcal{M}$ such that every object in the image of $i$ is cofibrant.
  Then the following defines the structure of a combinatorial model category on $\mathcal{M}^i$:
  \begin{itemize}
    \item
      A morphism $f : (m_X, X) \rightarrow (m_y, Y)$ in $\mathcal{M}^i$ is a cofibration if and only if $f : X \rightarrow Y$ is a cofibration in $\mathcal{M}$.
    \item
      A morphism $f : (m_X, X) \rightarrow (m_Y, Y)$ in $\mathcal{M}^i$ is a weak equivalence if and only if $\gamma(f) : (\gamma(m_X), \gamma(X)) \rightarrow (\gamma(m_Y), \gamma(Y))$ is an isomorphism in $(\operatorname{Ho} \mathcal{M})^{\gamma i}$.
  \end{itemize}
  A marked object $(X, m_X)$ is fibrant if and only if $X$ is fibrant in $\mathcal{M}$ and marked maps are stable under homotopy in $\mathcal{M}$; that is, if $k \simeq h : i(K) \rightarrow X$ are homotopic maps in $\mathcal{M}$ and $k$ is marked, then $h$ is marked.
  The adjunctions $(-)^\flat \dashv U$ and $U \dashv (-)^\sharp$ are Quillen adjunctions.
\end{theorem}

\begin{remark}
  The classification of weak equivalences in theorem \ref{th:marked-model-category} does not appear as stated in \cite{marked-objects}, but follows easily from results therein.
  Let $t : \mathrm{Id} \Rightarrow R : \mathcal{M} \rightarrow \mathcal{M}$ be the unit of a fibrant replacement functor.
  By \cite[lemma 2.5]{marked-objects}, a map $f : (m_X, X) \rightarrow (m_Y, Y)$ is a weak equivalence in $\mathcal{M}^i$ if and only if $f$ is a weak equivalence in $\mathcal{M}$ and for every diagram (of solid arrows)
  \begin{equation}
    \label{eq:isaev-classification-weak-equivalences}
    \begin{tikzcd}
      i(K) \arrow[drr, bend left, "k"] \arrow[ddr, bend right, "h"'] \arrow[dr, dashed, "h'"] \arrow[ddr, phantom, "\simeq"] \\
      & X \arrow[d, "t_X"] \arrow[r, "f"] & Y \arrow[d, "t_Y"]  \\
      & R(X) \arrow[r, "R(f)"] & R(Y)  \\
    \end{tikzcd}
  \end{equation}
  in which the outer square commutes up to homotopy and $k$ is marked, there exists a marked map $h' : i(K) \dashrightarrow X$ as indicated such that $h' t_X \simeq h$.
  ($h'$ is not required to commute with $k$ and $f$ in any sense.)

  Now assume that $f : (m_X, X) \rightarrow (m_Y, Y)$ satisfies this condition and let us prove that $\gamma(f)$ is an isomorphism of induced marked objects of the homotopy category.
  $\gamma(f)$ is an isomorphism in $\mathcal{M}$, so it suffices to show that $\gamma(f)^{-1}$ preserves markings.
  By definition, every marked morphism of $\gamma(Y)$ is of the form $\gamma(k) : \gamma(i(K)) \rightarrow \gamma(Y)$ for some marked $k : i(K) \rightarrow Y$.
  Because $i(X)$ is cofibrant and $R(X)$ is fibrant, the map $\gamma(t_X)^{-1} \gamma(f)^{-1} \gamma(k) : \gamma(i(K)) \rightarrow \gamma(R(X))$ has a preimage $h : i(X) \rightarrow R(X)$ under $\gamma$.
  \todo{Look this up.}
  As $i(K)$ is cofibrant, $R(Y)$ is fibrant and $\gamma(h \circ R(f)) = \gamma(t_Y k)$, there is a homotopy $h \circ R(f) \simeq t_Y k$.
  By assumption, there exists a marked map $h' : i(K) \rightarrow X$ such that $h' t_X \simeq h$, thus $\gamma(f)^{-1} \gamma(k) = \gamma(h')$ is marked.

  To prove the other direction of the equivalence, assume that $\gamma(f)$ is an isomorphism of marked objects and let $h, k$ as in \eqref{eq:isaev-classification-weak-equivalences}.
  $\gamma(f)^{-1} \gamma(k)$ is marked, hence has a preimage $h' : i(K) \rightarrow X$ under $\gamma$ which is marked.
  We have $\gamma(t_X h') = \gamma(h)$ because postcomposition of both sides with the isomorphism $\gamma9R(f))$ gives equal results.
  $i(K)$ is cofibrant and $R(X)$ is fibrant, thus $t_X h' \simeq h$.
\end{remark}

\begin{lemma}
  \label{lem:simplicial-marked-objects}
  Let $\mathcal{M}$ and $i : K \rightarrow \mathcal{M}$ be as in theorem \ref{th:marked-model-category}.
  \begin{enumerate}
    \item
      \label{itm:marked-left-proper}
      If $\mathcal{M}$ is a left proper model category, then $\mathcal{M}^i$ is a left proper model category.
    \item
      \label{itm:marked-simplicial}
      If $\mathcal{M}$ is a model $\mathrm{Gpd}$-category, then $\mathcal{M}^i$ admits the structure of a model $\mathrm{Gpd}$-category such that $(-)^\flat \dashv U$ and $U \dashv (-)^\sharp$ lift to Quillen $\mathrm{Gpd}$-adjunctions.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \emph{\ref{itm:marked-left-proper}}.
  Let 
  \begin{equation}
    \begin{tikzcd}
      X \arrow[r, "g"] \arrow[d, "f"] \arrow[dr, phantom, near end, "\ulcorner"] & Y_2 \arrow[d, "f'"] \\
      Y_1 \arrow[r, "g'"] & Z
    \end{tikzcd}
  \end{equation}
  \todo{indicate weak eq?}
  be a pushout square in $\mathcal{M}^i$ such that $f$ is a weak equivalence.
  $\mathcal{M}$ is left proper, so $\gamma(f')$ is invertible as a map in $\operatorname{Ho} \mathcal{M}$.

  A map $k : i(K) \rightarrow U(Z)$ is marked if and only if it factors via a marked map $k_1 : i(K) \rightarrow U(Y_1)$ or via a marked map $k_2 : i(K) \rightarrow U(Y_2)$.
  In the first case,
  \begin{equation}
    \gamma(f')^{-1} \gamma(k) = \gamma(g) \gamma(f)^{-1} \gamma(k_1),
  \end{equation}
  which is marked because $f$ is a weak equivalence, and otherwise
  \begin{equation}
    \gamma(f')^{-1} \gamma(k) = \gamma(k_2),
  \end{equation}
  which is marked, too.
  We have showed that $\gamma(f')$ is an isomorphism of marked objects in $\operatorname{Ho} \mathcal{M}$, thus $f'$ is a weak equivalence.

  \emph{\ref{itm:marked-simplicial}}.
  Let $X$ and $Y$ be marked objects.
  We define the mapping groupoid $\mathcal{M}^i(X, Y)$ as the full subgroupoid of $\mathcal{M}(G(X), G(Y))$ of marking preserving maps.

  $\mathcal{M}^i$ is complete and cocomplete as a 1-category.
  Thus if we construct tensors $\mathcal{G} \otimes X$ and powers $X^\mathcal{G}$ for all $X \in \operatorname{Ob} \mathcal{M}$ and $\mathcal{G} \in \operatorname{Ob} \mathrm{Gpd}$ it follows that $\mathcal{M}^i$ is also complete and cocomplete as a $\mathrm{Gpd}$-category.
  The underlying object of powers and copowers is constructed in $\mathcal{M}$, i.e.\@ $G(\mathcal{G} \otimes X) = \mathcal{G} \otimes G(X)$ and $G(X^\mathcal{G}) = G(X)^\mathcal{G}$.
  A map $k : i(K) \rightarrow X^\mathcal{G}$ is marked if and only if the composite
  \begin{equation}
    \begin{tikzcd}
      i(K) \arrow[r, "k"] & G(X)^\mathcal{G} \arrow[r, "X^v"] & G(X)^1 = G(X)
    \end{tikzcd}
  \end{equation}
  is marked for every $v \in \operatorname{Ob} \mathcal{G}$ (which we identify with a map $v : 1 \rightarrow \mathcal{G}$).
  Similarly, a map $k : i(K) \rightarrow \mathcal{G} \otimes X$ is marked if and only if it factors as
  \begin{equation}
    \begin{tikzcd}
      i(K) \arrow[r, "k_0"] & G(X) = 1 \otimes G(X) \arrow[r, "v \mathbin{\otimes} \mathrm{id}"] & \mathcal{G} \otimes G(X)
    \end{tikzcd}
  \end{equation}
  for some object $v : 1 \rightarrow \mathcal{G}$ and marked $k_0$.
  It follows by \cite[Theorem 4.85]{basic-concepts-of-enriched-category-theory} from the preservation of tensors and powers by $U$ that the 1-categorical adjunctions $(-)^\flat \dashv U$ and $U \dashv (-)^\flat$ extend to $\mathrm{Gpd}$-adjunctions.

  It remains to show that the tensoring $\mathrm{Gpd} \times \mathcal{M}^i \rightarrow \mathcal{M}^i$ is a Quillen bifunctor.
  For this we need to prove that if $f : \mathcal{G} \rightarrowtail \mathcal{H}$ is a cofibration of groupoids and $g : X \rightarrowtail Y$ is a cofibration of marked objects, then their pushout-product
  \begin{equation}
    f \mathbin{\square} g : \mathcal{G} \otimes Y \amalg_{\mathcal{G} \otimes X} \mathcal{H} \otimes X \rightarrow \mathcal{H} \otimes Y
  \end{equation}
  is a cofibration, and that it is a weak equivalence if either $f$ or $g$ is furthermore a weak equivalence.
  The first part follows directly from the same property for the $\mathrm{Gpd}$-enrichment of $\mathcal{M}$ and the fact that $U$ preserves tensors and pushouts, and reflects cofibrations.

  For the second part, we have in both cases that $f \mathbin{\square} g$ is a weak equivalence when considered as morphism in $\mathcal{M}$.
  Thus we only need to show that $f \mathbin{\square} g$ reflects a given marked morphism $k : i(K) \rightarrow \mathcal{H} \otimes G(Y)$ in $\operatorname{Ho} \mathcal{M}$.
  It follows from the construction of $\mathcal{H} \otimes Y$ that for any such $k$ there exists a vertex $w : 1 \rightarrow \mathcal{H}$ such that $k = (w \otimes \mathrm{id}) \circ k_0$ for some marked map $k_0 : i(K) \rightarrow G(Y)$.

  Assume first that $f$ is a trivial cofibration, i.e.\@ an equivalence of groupoids that is injective on objects.
  Then there exists an object $v : \Delta^0 \rightarrow S$ such that $f(v)$ and $w$ are equivalent in $\mathcal{H}$.
  Thus $k$ is (left) homotopic to $(f(v) \otimes \mathrm{id}) \circ k_0$, which factors via the marked map $(v \otimes \mathrm{id}) \circ k_0 : i(K) \rightarrow \mathcal{G} \otimes G(Y)$.
  Thus $\gamma(f)$ reflects marked morphisms.

  Now assume that $g$ is a trivial cofibration.
  Then $\gamma(g)$ reflects marked maps, i.e.\@ there exists a marked map $h_0 : i(K) \rightarrow G(X)$ such that $\gamma(g)\gamma(h_0) = \gamma(h)$.
  Thus the equivalence class of $(w \otimes \mathrm{id}) \circ h_0 : i(K) \rightarrow \mathcal{H} \otimes X$ in $\operatorname{Ho} \mathcal{M}$ is marked and mapped to $\gamma(k)$ under postcomposition by $\gamma(f)$.
\end{proof}

So far, the model structure is not aware of what kind of universal property marked diagrams are supposed to have, much like structures interpreting logical signatures are defined without reference to a set of axioms they might satisfy.
To obtain a model category of lcc sketches, we \emph{localize} at a set of morphisms which encode the axioms of lcc categories:
We want to consider lcc-marked categories equivalent if they represent the same lcc category.

\begin{definition}
  \label{def:lcc-axioms}
  The model category $\mathrm{Lcc}$ of lcc sketches is the left Bousfield localization of the model category of $I_\mathrm{Lcc}$-marked objects at the following cofibrations.
  \begin{itemize}
    \item
      There is a terminal object:
      \begin{equation}
        \mathbf{T_1} : \emptyset \rightarrow \{ t \}
      \end{equation}
      (in which $t$ is marked via $T$ in the codomain).
    \item
      There is a morphism from every object to every terminal object:
      \begin{equation}
        \mathbf{T_2} :
        \left\{
          \begin{tikzcd}
            \cdot & t
          \end{tikzcd}
        \right\}
        \rightarrow
        \left\{ 
          \begin{tikzcd}
            \cdot \arrow[r] & t
          \end{tikzcd}
        \right\} 
      \end{equation}
      (where $t$ is marked via $\mathrm{T}$ in domain and codomain).
    % \item[\bf T3]
    %   Any two morphisms with the same domain and terminal codomain are equal:
    %   \begin{equation}
    %     \left\{
    %       \begin{tikzcd}
    %         \cdot \arrow[r, shift left] \arrow[r, shift right] & t
    %       \end{tikzcd}
    %     \right\}
    %     \rightarrow
    %     \left\{ 
    %       \begin{tikzcd}
    %         \cdot \arrow[r] & t
    %       \end{tikzcd}
    %     \right\} 
    %   \end{equation}
    %   (where $t$ is marked via $\mathrm{T}$ in domain and codomain).
    \item
      \label{itm:pbs-commute}
      Pullback squares commute:
      \begin{equation}
        \mathbf{Pb_0} :
        \left\{
          \begin{tikzcd}
            \cdot \arrow[r, "p_2"] \arrow[d, "p_1"] & \cdot \arrow[d, "f_2"] \\
            \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
        \rightarrow
        \left\{
          \begin{tikzcd}
            \cdot \arrow[dr, phantom, "\circlearrowleft"] \arrow[r, "p_2"] \arrow[d, "p_1"] & \cdot \arrow[d, "f_2"] \\
            \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
      \end{equation}
      (where the squares in domain and codomain are marked via $\mathrm{Pb}$ but only the latter commutes).
    \item
      \label{itm:pbs-exist}
      Every cospan can be completed to a pullback square:
      \begin{equation}
        \mathbf{Pb_1} : 
        \left\{
          \begin{tikzcd}
            & \cdot \arrow[d, "f_2"] \\
            \cdot \arrow[r, "f_1"] & \cdot 
          \end{tikzcd}
        \right\}
        \rightarrow
        \left\{
          \begin{tikzcd}
            \cdot \arrow[r, "p_2"] \arrow[d, "p_1"] & \cdot \arrow[d, "f_2"] \\
            \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
      \end{equation}
      (where the domain is minimally marked and the square in the codomain is marked via $\mathrm{Pb}$).
    \item
      \label{itm:pbs-factorizations}
      Every square completing a cospan factors via any pullback square over that cospan:
      \begin{equation}
        \mathbf{Pb_2} : 
        \left\{
          \begin{tikzcd}
            \cdot \arrow[ddr, bend right, "q_1"'] \arrow[drr, bend left, "q_2"] \arrow[dr, phantom, "\circlearrowleft", near end] \\
            & \cdot \arrow[d, "p_1"] \arrow[r, "p_2"] & \cdot \arrow[d, "f_2"] \\
            & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
        \rightarrow
        \left\{
          \begin{tikzcd}
            \cdot \arrow[ddr, bend right, "q_1"'] \arrow[ddr, phantom, "\circlearrowleft"] \arrow[drr, bend left, "q_2"] \arrow[drr, phantom, "\circlearrowleft"] \arrow[dr] \\
            & \cdot \arrow[d, "p_1"] \arrow[r, "p_2"] & \cdot \arrow[d, "f_2"] \\
            & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
      \end{equation}
      (where the lower right squares are marked via $\mathrm{Pb}$ and the large squares commute in domain and codomain).
    % \item
    %   Every two factorizations via a pullback square are equal:
    %   \begin{equation}
    %     \left\{
    %       \begin{tikzcd}
    %         \cdot \arrow[ddr, bend right, "q_1"'] \arrow[ddr, phantom, "\circlearrowleft"] \arrow[drr, bend left, "q_2"] \arrow[drr, phantom, "\circlearrowleft"] \arrow[dr, shift left] \arrow[dr, shift right] \\
    %         & \cdot \arrow[d, "p_1"] \arrow[r, "p_2"] & \cdot \arrow[d, "f_2"] \\
    %         & \cdot \arrow[r, "f_1"] & \cdot
    %       \end{tikzcd}
    %     \right\}
    %     \rightarrow
    %     \left\{
    %       \begin{tikzcd}
    %         \cdot \arrow[ddr, bend right, "q_1"'] \arrow[ddr, phantom, "\circlearrowleft"] \arrow[drr, bend left, "q_2"] \arrow[drr, phantom, "\circlearrowleft"] \arrow[dr] \\
    %         & \cdot \arrow[d, "p_1"] \arrow[r, "p_2"] & \cdot \arrow[d, "f_2"] \\
    %         & \cdot \arrow[r, "f_1"] & \cdot
    %       \end{tikzcd}
    %     \right\}
    %   \end{equation}
    %   (where the lower right squares are marked via $\mathcal{B}$ and the large squares commute in domain and codomain).
    %   \todo{Make more explicit that the two parallel arrows both separately commute with $q_1$ and $q_2$}
    \item
      The evaluation map $\varepsilon$ commutes with the projection map:
      \begin{equation}
        \mathbf{Pi_0} :
        \left\{
          \begin{tikzcd}
            \cdot \arrow[ddr, bend right, "p_1"'] \arrow[drr, bend left, "p_2"] \arrow[dr, "\varepsilon"] \\
            & \cdot \arrow[d, "g"] & \cdot \arrow[d, "f_2"] \\
            & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
        \rightarrow
        \left\{
          \begin{tikzcd}
            \cdot \arrow[ddr, bend right, "p_1"'] \arrow[ddr, phantom, "\circlearrowleft"] \arrow[drr, bend left, "p_2"] \arrow[dr, "\varepsilon"] \\
            & \cdot \arrow[d, "g"] & \cdot \arrow[d, "f_2"] \\
            & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
      \end{equation}
      (where domain and codomain are marked via $\mathrm{Pb}$ and $\mathrm{Pi}$ as indicated by the variable names).
    \item
      There is a dependent product $f_2 = \Pi_{f_1} g$ for every composable pair of morphisms:
      \begin{equation}
        \mathbf{Pi_1} :
        \left\{
          \begin{tikzcd}
            & \cdot \arrow[d, "g"] \\
            & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
        \rightarrow
        \left\{
          \begin{tikzcd}
            \cdot \arrow[ddr, bend right, "p_1"] \arrow[drr, bend left, "p_2"] \arrow[dr, "\varepsilon"] \\
            & \cdot \arrow[d, "g"] & \cdot \arrow[d, "f_2"] \\
            & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
      \end{equation}
      (where the codomain is marked via $\mathrm{Pb}$ and $\mathrm{Pi}$ as indicated by the variable names).
    \item
      Any other morphism with an evaluation map factors via dependent products:
      \begin{equation}
        \mathbf{Pi_2} :
        \left\{
          \begin{tikzcd}
            \cdot \arrow[dddrr, bend right, "p'_1"'] \arrow[ddrrrr, bend left, "p'_2"] \arrow[ddrr, bend right] & \\
            & \cdot \arrow[ddr, bend right, "p_1", near end] \arrow[drr, bend left, "p_2"] \arrow[dr, "\varepsilon"] \\
            & & \cdot \arrow[d, "g"] & \cdot \arrow[d, "f_2"] & \cdot \arrow[dl, "f'_2"] \\
            & & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
        \rightarrow
        \left\{
          \begin{tikzcd}
            \cdot \arrow[dr] \arrow[dddrr, bend right, "p'_1"'] \arrow[ddrrrr, bend left, "p'_2"] \arrow[ddrr, bend right] & \\
            & \cdot \arrow[ddr, bend right, "p_1" near end] \arrow[drr, bend left, "p_2"] \arrow[dr, "\varepsilon"] \\
            & & \cdot \arrow[d, "g"] & \cdot \arrow[d, "f_2"] & \cdot \arrow[dl, "f'_2"] \arrow[l] \\
            & & \cdot \arrow[r, "f_1"] & \cdot
          \end{tikzcd}
        \right\}
      \end{equation}
      \todo{(where several squares and triangle commute.)}
  \end{itemize}
\end{definition}

\begin{proposition}
  The model category $\mathrm{Lcc}$ is a model for the $(2, 1)$-category of lcc categories and lcc functors:
  \begin{enumerate}
    \item
      \label{itm:lcc-fibrant-objects}
      An object $\mathcal{C} \in \mathcal{M}$ is fibrant if and only if its underlying category is lcc such that
      \begin{itemize}
        \item
          a map $i(\mathrm{T}) \rightarrow U(\mathcal{C})$ is marked if and only if its image is a terminal object;
        \item
          a map $i(\mathrm{Pb}) \rightarrow U(\mathcal{C})$ is marked if and only if its image is a  pullback square; and
        \item
          a map $i(\mathrm{Pi}) \rightarrow U(\mathcal{C})$ is marked if and only if its image is (isomorphic to) the diagram of the evaluation map of a dependent product.
      \end{itemize}
    \item
      \label{itm:lcc-homotopy-category}
      The homotopy category of $\mathrm{Lcc}$ is equivalent to the category of lcc categories and isomorphism classes of lcc functors.
    \item
      \label{itm:lcc-homotopy-function-complexes}
      The homotopy function complexes of fibrant lcc sketches are given by the groupoids of lcc functors and their natural isomorphisms.
  \end{enumerate}
\end{proposition}
\begin{proof}
  The homotopy function complexes of maps between fibrant objects in the localization of a model category $\mathcal{M}$ agree with those in $\mathcal{M}$, thus \ref{itm:lcc-homotopy-category} and \ref{itm:lcc-homotopy-function-complexes} follow from \ref{itm:lcc-fibrant-objects} and lemma \ref{lem:simplicial-marked-objects}.

  \ref{itm:lcc-fibrant-objects} is a classification of fibrant objects in left Bousfield localization $S^{-1} \mathrm{Cat}^{I_\mathrm{Lcc}}$, where $S$ is the set containing the morphisms defined in \ref{def:lcc-axioms}.
  By \todo{reference Hirschhorn}, these are precisely the $S$-local fibrant objects of $\mathrm{Cat}^{I_\mathrm{Lcc}}$, i.e.\@ fibrant lcc marked categories $\mathcal{C}$ such that for all morphism $f : A \rightarrow B$ in $S$ the induced map
  \begin{equation}
    \mathrm{sSet}(f, \mathcal{C}) : \mathrm{sSet}(B, \mathcal{C}) \rightarrow \mathrm{sSet}(A, \mathcal{C})
  \end{equation}
  is a trivial Kan fibration.
  Recall (\todo{lemma on enrichment}) that the mapping spaces $\mathrm{sSet}(-, \mathcal{C})$ of lcc-marked categories are the full subspaces of mapping spaces in $\mathrm{Cat}$ given by the marking preserving maps, and that the mapping spaces in $\mathrm{Cat}$ are the nerves of the groupoids of functors and their natural isomorphisms.
  Thus $\mathrm{sSet}(f, \mathcal{C})$ will be a trivial Kan fibration if it has the right lifting property with respect to the boundary inclusion $\partial \Delta^n \hookrightarrow \Delta^n$ for $n \leq 2$.

  The verification the equivalence asserted in \ref{itm:lcc-fibrant-objects} can be split up into three parts corresponding to terminal objects, pullback squares and dependent products.
  As all three parts are proved very similarly, only the part for pullback squares will be shown here.
  For this we must show that if $\mathcal{C}$ is a lcc-marked category, then marked maps of the form $i(\mathrm{Pb}) \rightarrow \mathcal{C}$ are stable under homotopy and $\mathrm{sSet}(\mathbf{Pb_i}, \mathcal{C})$ for $i = 0, 1, 2$ has the right lifting property with respect to $\partial \Delta^n \hookrightarrow \Delta^n$ for $n \leq 2$ if and only if the underlying category $U(\mathcal{C})$ has all pullbacks and maps $i(\mathrm{Pb}) \rightarrow U(\mathcal{C})$ are marked precisely when their images are a pullback squares.

  Let us unfold what it means that $\mathrm{sSet}(\mathbf{Pb_i}, \mathcal{C})$ has the right lifting property against $\partial \Delta^n \hookrightarrow \Delta^n$ for $i = 0, 1, 2$ and $n = 0, 1, 2$.
  \todo{
    Explain the ``vacuousness'' in the following list better.
    The conditions for $n = 2$ are trivially true for functors that are surjective on morphisms, and the condition for $n = 1$ is trivial if the functors are surjective on objects.
  }
  \begin{itemize}
    \item
      For $i = 0$ and $n = 0$ this is equivalent to images of marked maps $\mathrm{Pb} \rightarrow U(\mathcal{C})$ being commutative squares.
    \item
      For $i = 0$ and $n = 1$ or $n = 2$ the condition is vacuous.
    \item
      For $i = 1$ and $n = 0$ it says that every cospan $\cdot \xrightarrow{f_1} \cdot \xleftarrow{f_2} \cdot$ in $U(\mathcal{C})$ can be completed to a marked square.
    \item
      For $i = 1$ and $n = 1$ it says that every isomorphism of the lower cospans of two marked squares can be extended to an isomorphism of the full squares.
    \item
      For $i = 1$ and $n = 2$ it says that triangles of isomorphisms of marked squares commute as soon if their restrictions to cospans comute.
    \item
      For $i = 2$ and $n = 0$ it says that every square completing the cospan of a marked square factors via the marked square.
    \item
      For $i = 2$ and $n = 1$ it says that factorizations as in the case $i = 2$, $n = 0$ are compatible with isomorphisms of marked squares and completions of their cospans.
    \item
      For $i = 2$ and $n = 2$ the condition is vacuous.
  \end{itemize}
  Now suppose that these conditions are satisfied.
  Then every marked square is a pullback square:
  Marked square commute by the condition for $n = 0, i = 0$.
  The case $n = 2, i = 1$ guarantees that every cone over the lower cospan of a marked square factors via the marked square, and by $n = 2, i = 2$ instantiated with the identity isomorphism implies uniquness of the factorization.
  $\mathcal{C}$ has all pullbacks by the condition for $i = 1, n = 0$.
  Finally, if marked squares are stable under homotopy (i.e.\@ isomorphism), then all pullback squares will be marked because they are isomorphic to the marked squares over their cospans by the condition for $i = 1, n = 0$.

  On the other hand, if $U(\mathcal{C})$ has all pullbacks and squares are marked if and only if they are pullback squares, then all of these conditions are satisfied, and marked squares are stable under isomorphism.
\end{proof}

\section{Strict lcc categories}
\label{sec:strict-lcc-categories}

As explained in the introduction, our ultimate goal is to define an interpretation of extensional dependent type theory in which contexts are interpreted as lcc categories, substitutions as lcc functors, types as objects in lcc categories and terms as morphisms with terminal domain.
However, the category $\mathrm{Lcc}$ defined in \ref{sec:lcc-sketches} is not suitable for this purpose:
All type theoretic structure has the be preserved up to equality by substitutions, but lcc functors preserve the corresponding objects with universal properties only up to isomorphism.
Luckily $\mathrm{Lcc}$ is just one particular presentation of the $(2, 1)$-category of lcc categories, and so we may hope to find alternative presentations which are more suitable for interpreting type theory.
In this section, we explain results from the literature for building such alternative descriptions.
As a first step, we have to rectify the fact that lcc functors do not preserve lcc structure up to equality.
Indeed, the way we have defined lcc sketches and categories, we cannot even state when an lcc functor is strict because there is no canonical choice of lcc structure.
Lcc categories are fibrant lcc sketches, which means that they have the right lifting \emph{property} against the generating trivial cofibrants of $\mathrm{Lcc}$.
In order to speak of canonical choices of lcc structure, we need canonical lifts against the trivial cofibrations.

\begin{definition}[\cite{algebraic-models}]
  Let $\mathcal{M}$ be a combinatorial model category with set $J$ of generating trivial cofibrations.
  An \emph{algebraically fibrant object} of $\mathcal{M}$ (with respect to $J$) consists of an object $G(X) \in \operatorname{Ob} \mathcal{M}$ equipped with a choice of lifts against all morphisms $j \in J$.
  Thus $X$ comes with choices of lifts $\ell_X({j, a}) : B \rightarrow G(X)$ for all $j : A \rightarrow B$ in $J$ and $a : A \rightarrow G(X)$ in $\mathcal{M}$ such that
  \begin{equation}
    \begin{tikzcd}
      A \arrow[d, "j"] \arrow[r, "a"] & G(X) \\
      B \arrow[ur, "{\ell_X(j, a)}"']
    \end{tikzcd}
  \end{equation}
  commutes.
  A morphism of algebraically fibrant objects $f : X \rightarrow Y$ is a morphism $f : G(X) \rightarrow G(Y)$ in $\mathcal{M}$ that preserves the choices of lifts, in the sense that $f \ell_X(j, a) = \ell_Y(j, fa)$ for all $j : A \rightarrow B$ in $J$ and $a : A \rightarrow G(X)$.
  The category of algebraically fibrant objects is denoted by $\operatorname{Alg} \mathcal{M}$, and the evident forgetful functor $\operatorname{Alg} \mathcal{M} \rightarrow \mathcal{M}$ by $G$.
\end{definition}

Fix a set $J$ of generating trivial cofibrations of $\mathrm{Lcc}$.
As all of the morphisms $\mathbf{T_1}$, $\mathbf{Pb_1}$ and $\mathbf{Pi_1}$ of definition \ref{def:lcc-axioms} are trivial cofibrations in $\mathrm{Lcc}$, we may assume that they are in $J$.
Let $\mathcal{C}$ be an algebraically fibrant lcc sketch (with respect to $J$).
Then $G(\mathcal{C})$ is a fibrant lcc sketch, i.e.\@ an lcc category.
The lifts $\ell_\mathcal{C}(j, a)$ against generating trivial cofibrations $j \in J$ determine canonical lcc structure on $\mathcal{C}$:
The lift against $\mathbf{T_1}$ determines a canonical terminal object, lifts against $\mathbf{Pb_1}$ determine canonical pullback squares, and lifts against $\mathbf{Pi_1}$ determine canonical dependent products.
Morphisms of fibrant lcc sketches preserve the universal properties of terminal objects, pullback squares and dependent products.
Morphisms of algebraically fibrant lcc sketches furthermore preserve canonical choices of these universal objects:
They are strict lcc functors.

\begin{theorem}[\cite{algebraic-models} Proposition 2.4, \cite{equipping-weak-equivalences} Theorem 19]
  \label{th:algebraically-fibrant-model-category}
  Suppose $\mathcal{M}$ is a combinatorial model category.
  Then $G$ is monadic with left adjoint $F$, and $\operatorname{Alg} \mathcal{M}$ is a locally presentable category.
  The model structure of $\mathcal{M}$ can be transferred along the adjunction $F \dashv G$ to $\operatorname{Alg} \mathcal{M}$, making $\operatorname{Alg} \mathcal{M}$ a combinatorial model category and $F \dashv G$ a Quillen equivalence.
\end{theorem}

\begin{lemma}
  \label{lem:algebraically-fibrant-lproper-simplicial}
  Let $\mathcal{M}$ be as in theorem \ref{th:algebraically-fibrant-model-category}.
  \begin{enumerate}
    \item
      \label{itm:algebraic-left-proper}
      If $\mathcal{M}$ is a left proper model category, then $\operatorname{Alg} \mathcal{M}$ is a left proper model category.
      \todo{Is this needed? Looks nice as it is because it's similar to the analogue for marked objects.}
    \item
      \label{itm:algebraic-simplicial}
      Suppose that $\mathcal{M}$ is a model $\mathrm{Gpd}$-category.
      Then $\operatorname{Alg} \mathcal{M}$ has the structure of a model $\mathrm{Gpd}$-category, and the the adjunction $F \dashv G$ lifts to a Quillen $\mathrm{Gpd}$-adjunction.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \emph{\ref{itm:algebraic-left-proper}.}
  \todo{TODO}

  \emph{\ref{itm:algebraic-simplicial}.}
  Let $X$ and $Y$ be algebraically fibrant objects.
  We define the mapping groupoid $(\operatorname{Alg} \mathcal{M})(X, Y)$ to be the full subgroupoid of $\mathcal{M}(G(X), G(Y))$ given by the maps of algebraically fibrant objects $X \rightarrow Y$.

  Because $\mathrm{Gpd}$ is generated under colimits by the walking isomorphism $\mathcal{I}$, it will follow from the existence of powers $X^\mathcal{I}$ that $\operatorname{Alg} \mathcal{M}$ is complete as a $\mathrm{Gpd}$-category.
  These powers are constructed such that they commute with $G$, i.e.\@ we have $G(X^\mathcal{G}) = G(X)^\mathcal{G}$.
  The lifts $\ell = \ell_{X^\mathcal{I}}(j, a) : B \rightarrow G(X)^\mathcal{I}$ for $j : A \rightarrow B$ and $a : A \rightarrow G(X)^\mathcal{I}$ are defined as indicated in the following diagram:
  \begin{equation}
    \begin{tikzcd}
      A \arrow[r, "a"] \arrow[d, "j"'] & G(X)^\mathcal{I} \arrow[d, "G(X)^{\{0, 1\}}"] \\
      B \arrow[r, "{\langle \ell_0, \ell_1 \rangle}"'] \arrow[ur, dashed, "\ell"] & G(X)^2
    \end{tikzcd}
    \label{eq:lift-in-power}
  \end{equation}
  Here the right vertical map is given by restriction along the inclusion $2 \subseteq \mathcal{I}$ of the discrete groupoid with two objects into $\mathcal{I}$.
  There is a canonical isomorphism $G(X)^2 \cong G(X) \times G(X)$, and $\ell_i$ is defined as $\ell_X(j, X^{\{i\}} \circ a)$, i.e.\@ as canonical lift of $X$ after restriction to one of the two endpoints of $\mathcal{I}$.
  Because the inclusion $2 \subseteq \mathcal{I}$ is a cofibration, the right vertical map $G(X)^{\{0, 1\}}$ is a fibration, thus there exists a diagonal lift $\ell$ as indicated.

  In fact $\ell$ as defined as a lift in \eqref{eq:lift-in-power} is unique:
  Any other lift $\ell'$ will be homotopic to $\ell$.
  This homotopy can be described as a map $\mathcal{I} \times \mathcal{I} \rightarrow \mathcal{M}(B, G(X))$, i.e.\@ a commuting square
  \begin{equation}
    \begin{tikzcd}
      \ell_0 \arrow[r, "\ell"] \arrow[d, equals] & \ell_1 \arrow[d, equals] \\
      \ell_0 \arrow[r, "\ell'"] & \ell_1 \\
    \end{tikzcd}
  \end{equation}
  which implies that $\ell = \ell'$.
  From uniqueness of $\ell$ it follows that a map $G(Y) \rightarrow G(X)^\mathcal{I}$ preserves canonical lifts if and only if the two composites
  \begin{equation}
    \begin{tikzcd}[column sep=large]
      G(Y) \arrow[r] & G(X)^\mathcal{I} \arrow[r, "G(X)^{\{i\}}"] & G(X)
    \end{tikzcd}
  \end{equation}
  for $i = 0, 1$ preserve canonical lifts.
  Thus the canonical isomorphism
  \begin{equation}
    \mathrm{Gpd}(\mathcal{I}, \mathcal{M}(G(Y), G(X))) \cong \mathcal{M}(G(Y), G(X)^\mathcal{I})
  \end{equation}
  restricts to an isomorphism
  \begin{equation}
    \mathrm{Gpd}(\mathcal{I}, (\operatorname{Alg} \mathcal{M})(Y, X)) \cong (\operatorname{Alg} \mathcal{M})(Y, X^\mathcal{I}).
  \end{equation}

  It follows by \cite[theorem 4.85]{basic-concepts-of-enriched-category-theory} and the preservation of powers by $G$ that the adjunction $F \dashv G$ lifts to a $\mathrm{Gpd}$-adjunction.
  It is proved in \cite{algebraic-models} that $G$, when considered as a functor of ordinary categories, is monadic using Beck's monadicity theorem.
  The only additional assumption for the enriched version of Beck's theorem \cite[theorem II.2.1]{enriched-kan-extensions} we have to check is that the coequalizer of a $G$-split pair of morphisms as constructed in \cite{algebraic-models} is a colimit also in the enriched sense.
  This follows immediately from the fact that $G$ is full and faithful on 2-cells.
  $G$ is $\mathrm{Gpd}$-monadic and accessible (see \todo{where?}), so $\operatorname{Alg} \mathcal{M}$ is $\mathrm{Gpd}$-cocomplete by \todo{two-dimensional monad theory}.

  It remains to show that $\operatorname{Alg} \mathcal{M}$ is groupoid enriched also in the model categorical sense.
  For this it suffices to remark that $G$ preserves limits and that $G$ preserves and reflects fibrations and weak equivalences, so the map
  \begin{equation}
    X^\mathcal{H} \rightarrow X^\mathcal{G} \times_{Y^\mathcal{G}} Y^\mathcal{H}
  \end{equation}
  induced by a cofibration of groupoids $f : \mathcal{G} \rightarrowtail \mathcal{H}$ and a fibration $g : X \rightarrow Y$ in $\operatorname{Alg} \mathcal{M}$ is a fibration and a weak equivalence if either $f$ or $g$ is a weak equivalence.
\end{proof}

With theorem \ref{th:algebraically-fibrant-model-category} we have found an equivalent model for the category of lcc categories:
\begin{definition}
  The model category of strict lcc categories and strict lcc functors is given by $\mathrm{sLcc} = \operatorname{Alg} \mathrm{Lcc}$.
  The canonical covariant cwf structure on $\mathrm{sLcc}$ is given by $\mathrm{Ty}(\Gamma) = \operatorname{Ob} \Gamma$ and $\mathrm{Tm}(\Gamma, \sigma) = \mathrm{Hom}_\Gamma(1, \sigma)$, where $1$ denotes the canonical terminal object of $\Gamma$.
\end{definition}

\begin{proposition}
  The covariant cwf $\mathrm{sLcc}$ supports an empty context, context extension, finite product types and equality types.
\end{proposition}
\begin{proof}
  $\mathrm{sLcc}$ is a model category and in particular has an initial object, hence supports an empty context.
  
  Let $\Gamma \vdash \sigma$.
  The context extension $\Gamma.\sigma$ can be constructed as pushout
  \begin{equation}
    \begin{tikzcd}
      F(\{ t, \sigma \}) \arrow[d] \arrow[r] & F(\{ v : t \rightarrow \sigma \}) \arrow[d] \\
      \Gamma \arrow[r, "p"] & \Gamma.\sigma,
    \end{tikzcd}
  \end{equation}
  where $\{ t, \sigma \}$ denotes an lcc sketch with two objects and $\{ v : t \rightarrow \sigma \}$ is an lcc sketch with a single nontrivial morphism.
  The vertical morphism on the left is induced by mapping $t$ to $1$ and $\sigma$ to $\sigma$, and the top morphism is the evident inclusion.
  The variable $\Gamma.\sigma \vdash \mathbf{v} : p(\sigma)$ is given by the image of $v$.

  Unit types $\Gamma \vdash \mathbf{1}$ are given by the canonical terminal objects of strict lcc categories $\Gamma$.
  Binary product types $\Gamma \vdash \sigma \mathbf{\times} \tau$ are given by fibre products $\sigma \times_1 \tau$ over the canonical terminal object $1$ in $\Gamma$.
  Finally, equality types $\Gamma \vdash \operatorname{\mathbf{Eq}} s \, t$ are constructed as canonical pullbacks
  \begin{equation}
    \label{eq:slcc-context-extension}
    \begin{tikzcd}
      \operatorname{\mathbf{Eq}} s \, t \arrow[r] \arrow[d] & 1 \arrow[d, "t"] \\
      1 \arrow[r, "s"] & \sigma,
    \end{tikzcd}
  \end{equation}
  in $\Gamma$, i.e.\@ as equalizers of $s$ and $t$.

  The type constructors defined such (and evident term constructors) are built from the canonical structure of strict lcc category and hence stable under substitution.
\end{proof}

Unfortunately, $\mathrm{sLcc}$ does not support $\mathbf{\Pi}$- or $\mathbf{\Sigma}$-types in a similarly obvious way.
The type forming rule for $\Pi$-types is
\begin{equation}
  \inferrule
  {\Gamma \vdash \sigma \\ \Gamma.\sigma \vdash \tau}
  {\Gamma \vdash \Pi_\sigma \tau}.
\end{equation}
To interpret it, we would like to apply the dependent product functor $\Gamma_{/ \sigma} \rightarrow \Gamma$ of underlying categories to $\tau$.
But $\tau$ is an object of $\Gamma.\sigma$, so we will first need to construct a comparison map $D : \Gamma.\sigma \rightarrow \Gamma_{/ \sigma}$.

$\Gamma.\sigma$ has a universal property, and it is tempting to define $D$ as a strict lcc functor.
Note that the slice category $U(\Gamma_{/ \sigma})$ can be constructed as pullback
\begin{equation}
  \Gamma
\end{equation}

$\Gamma.\sigma$ has a universal property
First
A first attempt at constructing it is to use of the universal property of $\Gamma.\sigma$ as context extension:
The pullback functor $\sigma^* : \Gamma \rightarrow \Gamma_{/ \sigma}$ is lcc and the diagonal $d : \sigma \rightarrow \sigma \times \sigma$ induces a term $\Gamma_{\sigma} \vdash d' : \sigma \times \sigma$ in $\Gamma_{/ \sigma}$.
However, the pullback functor $\sigma^*$, while lcc, is usually not strict lcc, whereas the universal property of $\Gamma.\sigma$ requires a strict lcc functor.

\section{Algebraically cofibrant strict lcc categories}
\label{sec:algebraically-cofibrant}

Recall that the slice category $\Gamma_{/ \sigma}$ of an lcc category $\Gamma$ (or any category with finite limits) is bifreely generated from the pullback functor $\sigma^* : \Gamma \rightarrow \Gamma_{/ \sigma}$ and the diagonal of $\sigma$, which in $\Gamma_{/ \sigma}$ is up to isomorphism a morphism from the terminal object to $\sigma^*(\sigma)$.
Phrased model categorically, bifreeness amounts to asserting that the square
\begin{equation}
  \label{eq:homotopy-pushout-lcc}
  \begin{tikzcd}
    \{ t, \sigma \} \arrow[r] \arrow[d] & \{ v : t \rightarrow \sigma \} \arrow[d] \\
    \Gamma \arrow[r, "\sigma^*"] & \Gamma_{/ \sigma}
  \end{tikzcd}
\end{equation}
is a homotopy pushout square in $\mathrm{Lcc}$.
Equivalently, the two lcc sketches appearing in the top row can be replaced by weakly equivalent fibrant objects, giving us the homotopy pushout square
\begin{equation}
  \label{eq:homotopy-pushout-lcc}
  \begin{tikzcd}
    G(F(\{ t, \sigma \})) \arrow[r] \arrow[d] & G(F(\{ v : t \rightarrow \sigma \})) \arrow[d] \\
    \Gamma \arrow[r, "\sigma^*"] & \Gamma_{/ \sigma}.
  \end{tikzcd}
\end{equation}

Because $\mathrm{Lcc}$ and $\mathrm{sLcc}$ are Quillen equivalent, we should thus expect $\Gamma_{/ \sigma}$ and $\Gamma.\sigma$ to be weakly equivalent if the pushout square \eqref{eq:slcc-context-extension} is a homotopy pushout square.
By \todo{Lurie somewhere, see also nlab}, this is the case if the three objects forming the upper left span are cofibrant and the left or top leg is a cofibration.
The cofibrations of $\mathrm{Lcc}$ are the maps whose underlying functors are injective on objects.
Thus $\{t, \sigma\}$ and $\{ v : t \rightarrow \sigma\}$ are cofibrant lcc sketches, and the inclusion of the former into the latter is a cofibration.
$F$ is a left Quillen functor and so preserves cofibrations.
Thus the conditions of \todo{ibd.} are satisfied if $\Gamma$ is cofibrant, and in this case we should expect a weak equivalence relating $\Gamma.\sigma$ with $\Gamma_{/ \sigma}$.

Note that the counit $\varepsilon : FG \Rightarrow \mathrm{Id} : \mathrm{sLcc} \rightarrow \mathrm{sLcc}$ is a cofibrant replacement: $F \dashv G$ is a Quillen equivalence and every object in $\mathrm{Lcc}$ is cofibrant.
It follows that a strict lcc category $\Gamma$ is cofibrant if and only if the counit $\varepsilon_\Gamma$ is a retraction, say with section $\lambda : \Gamma \rightarrow F(G(\Gamma))$.
This retraction can be used to strictify the pullback functor:
We have $\sigma^* : G(\Gamma) \rightarrow G(\Gamma)_{/ \sigma}$, which induces a strict lcc functor $\overline{\sigma^*} : F(G(\Gamma)) \rightarrow \Gamma_{/ \sigma}$.
Now $(\sigma^*)^s = \lambda \circ \overline{\sigma^*} : \Gamma \rightarrow \Gamma_{/ \sigma}$, and $G(((\sigma)^*)^s)$ is naturally isomorphic to $\sigma^*$ \todo{because the unit of the adjunction is an equivalence}.
It follows that the diagonal $d$ can be pre- and postcomposed with this natural equivalence, giving a term of type $\sigma^s(\sigma)$ in $\Gamma_{/ \sigma}$, which induces the required comparison functor $D : \Gamma.\sigma \rightarrow \Gamma_{/ \sigma}$.
Given $\Gamma.\sigma \vdash \tau$, we might then try to define $\Gamma \vdash \mathbf{\Pi}_\sigma \, \tau$ as the image of $\tau$ under the composite $\Gamma.\sigma \xrightarrow{D} \Gamma_{/ \sigma} \xrightarrow{\Pi_\sigma} \Gamma$.
As a first attempt, we might thus restrict the category of contexts to the cofibrant strict lcc categories.
Indeed, cofibrant objects are stable under pushouts along cofibrations, thus context extensions $\Gamma.\sigma$ will be cofibrant again if $\Gamma$ was.
However, the definition of the comparison functor $D : \Gamma.\sigma \rightarrow \Gamma_{/ \sigma}$ required a \emph{choice} of retraction $\lambda : \Gamma \rightarrow F(G(\Gamma))$, and some choices will not be compatible with even strict lcc functors $\Gamma \rightarrow \Delta$.
Thus the $\Pi$-types defined such will not be stable under substitution.

To solve this issue, we make the retraction $\lambda$ part of the structure:
Similarly to how strict lcc categories have associated structure corresponding to their fibrancy in lcc, we make the retraction $\lambda$ witnessing the cofibrancy of strict lcc categories part of the data.
We thus consider algebraically cofibrant objects, which, dually to algebraically fibrant objects, are defined as coalgebras for a cofibrant replacement comonad.
Like in the case of algebraically fibrant objects, we are justified in doing so because we obtain an equivalent model category:

\begin{theorem}[\cite{coalgebraic-models} Lemmas 1.2 and 1.3, Theorems 1.4 and 2.5]
  \label{th:coalgebraic-model-category}
  Let $\mathcal{M}$ be a combinatorial and simplicial model category.
  Then there are arbitrarily large cardinals $\lambda$ such that
  \begin{enumerate}
    \item
      $\mathcal{M}$ is is locally $\lambda$-presentable;
    \item
      $\mathcal{M}$ is cofibrantly generated with a set of generating cofibrations for which domains and codomains are $\lambda$-presentable objects;
    \item
      an object $X \in \mathcal{M}$ is $\lambda$-presentable if and only if the functor $\mathrm{Hom}(X, -) : \mathcal{M} \rightarrow \mathrm{Set}$, given by the simplicial enrichment of $\mathcal{M}$, preserves $\lambda$-filtered colimits.
  \end{enumerate}

  Let $\lambda$ be any such cardinal.
  Then there is a simplicially-enriched cofibrant replacement comonad $C : \mathcal{M} \rightarrow \mathcal{M}$ that preserves $\lambda$-filtered colimits. 
  Let $C$ be any such comonad and denote its category of coalgebras by $\operatorname{Coa} \mathcal{M}$.

  Then the forgetful functor $U : \operatorname{Coa} \mathcal{M} \rightarrow \mathcal{M}$ has a left adjoint $V$.
  $\operatorname{Coa} \mathcal{M}$ has the structure of a simplicially enriched category with tensors and powers, and $V \dashv U$ is a simplicial adjunction.
  The model category structure of $\mathcal{M}$ can be transferred along $V \dashv U$, making $\operatorname{Coa} \mathcal{M}$ a simplicial and combinatorial model category.
  $V \dashv U$ is a simplicial Quillen equivalence.
\end{theorem}

In our case, the first infinite cardinal $\omega$ satisfies the three conditions of theorem \ref{th:coalgebraic-model-category}, and $C = FG$ can be chosen as a cofibrant replacement comonad.
\todo{
  Verify this.
  Conditions (1) and (2) are clear.
  For condition (3), I think it suffices by the proof in \cite{coalgebraic-models} that
  \begin{align}
    & \mathrm{Hom}(\Delta^n \otimes \mathcal{C}, \operatorname{colim}_i \mathcal{D}_i) \\
    \cong {} & \mathrm{Hom}(\mathcal{C}, (\operatorname{colim}_i \mathcal{D}_i)^{\Delta^n}) \\
    \cong {} & \mathrm{Hom}(\mathcal{C}, \operatorname{colim}_i (\mathcal{D}_i^{\Delta^n})) \\
    \cong {} & \operatorname{colim}_i \mathrm{Hom}(\mathcal{C}, \mathcal{D}_i^{\Delta^n}) \\
    \cong {} & \mathrm{Hom}(\Delta^n \otimes \mathcal{C}, \operatorname{colim}_i \mathcal{D}_i) 
  \end{align}
  if $\mathcal{C}$ is finitely presentable and the $\mathcal{D}_i$ are filtered.
}

\begin{definition}
  The canonical covariant cwf structure on $\operatorname{Coa} \mathrm{sLcc}$ is defined by $\mathrm{Ty}((\Gamma, \lambda)) = \mathrm{Ty}(\Gamma)$ and $\mathrm{Tm}((\Gamma, \lambda), \sigma) = \mathrm{Tm}(\Gamma, \sigma)$ in terms of the canonical covariant cwf structure of $\mathrm{sLcc}$.
\end{definition}

\begin{lemma}
  Let $\lambda : \Gamma \rightarrow F(G(\Gamma))$ be a coalgebra for $FG$.
  Then there is a canonical natural isomorphism $\phi : G(\lambda) \cong \eta_{G(\Gamma)} : G(\Gamma) \rightarrow G(F(G(\Gamma)))$ for lcc functors, which is compatible with morphisms of $FG$-coalgebras.
\end{lemma}
\begin{proof}
  By one of the triangle identities and $\lambda$ being a coalgebra, we have
  \begin{equation}
    G(\varepsilon_\Gamma \circ \lambda) = G(\varepsilon_\Gamma) \circ \eta_{G(\Gamma)} = \mathrm{Id} : G(\Gamma) \rightarrow G(\Gamma).
  \end{equation}
  Because $F \dashv G$ is a Quillen equivalence, the composite $\eta_{G(\Gamma)} \circ G(\varepsilon_\Gamma) : G(\Gamma) \rightarrow G(\Gamma)$ is naturally isomorphic to the identity.
  A natural isomorphism $\theta : G(F(G(\Gamma)) \rightarrow G(F(G(\Gamma)))^{\Delta^1}$ can be constructed explicitly using the inserter \todo{finish proof}.
\end{proof}

\begin{proposition}
  The covariant cwf $\operatorname{Coa} \mathrm{sLcc}$ supports an empty context and context extension, and the forgetful functor $\operatorname{Coa} \mathrm{sLcc} \rightarrow \mathrm{sLcc}$ preserves both.
\end{proposition}
\begin{proof}
  The model category $\operatorname{Coa} \mathrm{sLcc}$ has an initial object, i.e.\@ an empty context.
  Its underlying strict lcc category $\Gamma$ is the initial strict lcc category, and the structure map $i : \Gamma \rightarrow F(G(\Gamma))$ is the unique strict lcc functor with this signature.

  Let $(\Gamma, i)$ be a context and let $(\Gamma, i) \vdash \sigma$ be a type.
  The underlying strict lcc category of the context extension $(\Gamma,\lambda).\sigma$ is defined as the context extension $p : \Gamma \rightarrow \Gamma.\sigma, \Gamma \vdash \mathbf{v} : p(\sigma)$ in $\mathrm{sLcc}$.
  The structure map $i.\sigma : \Gamma.\sigma \rightarrow F(G(\Gamma.\sigma))$ is induced by the composite $\Gamma \xrightarrow{i} F(G(\Gamma)) \xrightarrow{F(G(p))}$ and the term $w$ in $F(G(\Gamma.\sigma))$ defined by commutativity of
  \begin{equation}
    \begin{tikzcd}
      1 \arrow[r, "v"] & F(G(p))(i(\sigma)) \\
      \eta(1) \arrow[r, "\eta(\mathbf{v})"] & \eta(p(\sigma))
    \end{tikzcd}
  \end{equation}

  $\operatorname{Coa} \mathrm{sLcc}$ is a model category and in particular cocomplete, hence posesses an initial object, i.e.\@ an empty context.
  \todo{Explicity description?}

  \todo{
    Spell out the proof on my board for context extension.
    The underlying strict lcc category is the strict context extension as explained before.
    Its comonad structure $\Gamma.\sigma \rightarrow FG(\Gamma)$ is defined by the universal property and the previous lemma.
    Its universal property among coalgebra morphisms is again verified with the universal property (it amounts to proving that two strict lcc functors with domain $\Gamma.\sigma$ are equal).
  }
\end{proof}

\begin{lemma}
  \label{lem:extension-to-slice}
  For each context $\lambda : \Gamma \rightarrow F(G(\Gamma))$ and type $\Gamma \vdash \sigma$ there is a strict lcc functor $D : \Gamma.\sigma \rightarrow \Gamma_{/ \sigma}$ which is a weak equivalence in $\mathrm{sLcc}$.
  The construction of $D = D_{\lambda, \sigma}$ is natural with respect to coalgebra morphisms $f : (\Gamma, \lambda) \rightarrow (\Delta, \mu)$, in the sense that
  \begin{equation}
    \begin{tikzcd}
      \Gamma.\sigma \arrow[d, "D_{\lambda, \sigma}"] \arrow[r, "f.\sigma"] & \Delta.f(\sigma) \arrow[d, "D_{\mu, f(\sigma)}"] \\
      \Gamma_{/ \sigma} \arrow[r, "f_{/ \sigma}"] & \Delta_{/ f(\sigma)}
    \end{tikzcd}
  \end{equation}
  commutes.
\end{lemma}
\begin{proof}
  \todo{This is basically explained in the meta of this chapter---the problem there was that $\lambda$ might not be preserved, but this is fixed now.}
\end{proof}

\begin{theorem}
  \label{th:lcc-supports-types}
  The cwf $\mathbf{Lcc}$ supports unit, extensional equality, $\mathbf{\Pi}$ and $\mathbf{\Sigma}$ types.
\end{theorem}
\begin{proof}
  As explained earlier unit types can be interpreted as canonical terminal objects and equality types as equalizers (which can be constructed uniformly from pullback squares).
  \todo{
    Should probably be worked out properly at least once somewhere.
    Maybe this can be done in the previous section for just strict lcc categories, and then I can handwave that it works the same here.
  }

  \emph{$\mathbf{\Pi}$-types.}
  Let $\Gamma \vdash \sigma$ and $\Gamma.\sigma \vdash \tau$.
  Then $\Gamma \vdash \mathbf{\Pi}_\sigma \, \tau$ is defined as $\Pi_\sigma(D(\tau))$, where $D : \Gamma.\sigma \rightarrow \Gamma_{/ \sigma}$ is as in lemma \ref{lem:extension-to-slice} and $\Pi_\sigma : \Gamma_{/ \sigma} \rightarrow \Gamma$ is the canonical right adjoint to the canonical pullback functor (\todo{should probably say what's meant by ``canonical'' here: It's a version of $\Pi$ constructed (uniformly for all slcc categories) from the canonical lifts of strict lcc categories.}
  $D$ and $\Pi_\sigma$ are natural with respect to cosubstitutions, so the $\Pi$-types defined such are stable under substitution.

  Now let $\Gamma.\sigma \vdash t : \tau$.
  We must construct a lambda abstraction $\Gamma \vdash \mathbf{\lambda}(t) : \mathbf{\Pi}_\sigma \, \tau$.
  This is done by mapping $t$ to $\Gamma_{/ \sigma}$ using the comparison functor $D$ as above, and using the adjunction $\sigma^* \dashv \Pi_\sigma$ to obtain a morphism $\mathbf{\lambda}(t) : \top \rightarrow \Pi_\sigma(D(\tau))$ in $\Gamma$ from the morphism $\sigma^*(\top) \xrightarrow{\sim} \top \xrightarrow{D(t)} D(\tau)$ in $\Gamma_{/ \sigma}$.
  Here the morphism $\sigma^*(\top) \xrightarrow{\sim} \top$ can be explictly constructed from the strict lcc structure of $\Gamma$, hence is stable under substitution.
  Application of $\Gamma \vdash u : \mathbf{\Pi}_\sigma \, \tau$ to the variable in an extended context $\Gamma.\sigma \vdash \mathbf{App}(u)$ is constructed along the same lines. \todo{explain more}
  The required equations hold because of adjointness \todo{explain more}
  \todo{
    Actually, this can maybe be done somewhat more elegant by first proving that cwf has $\Pi$ types iff there is an adjunction among categories of terms in context or something.
    The category of terms in context is likely equivalent isomorphic to the context (i.e.\@ the underlying slcc category) itself.
  }

  \todo{
    $\Sigma$-types, but that's probably also easier handled first purely in term of categories of terms in context.
  }
\end{proof}

\section{Recovering an interpretation in a single lcc category}

This section is devoted to showing that theorem \ref{th:lcc-supports-types} allows recovery of type theory in a given lcc category.

\begin{lemma}
  Let $\mathbf{C}$ be a covariant cwf and let $\Gamma \in \mathbf{C}$ be a context.
  Then the coslice category $\mathbf{C}_{\Gamma /}$ carries the structure of a covariant cwf such that the canonical inclusion $\mathbf{C}_{\Gamma /} \rightarrow \mathbf{C}$ preserves all structure of covariant cwfs except for the empty context and is full on types and terms.
  \qed
\end{lemma}

\begin{theorem}
  \label{th:context-as-model}
  Let $\Gamma \in \mathbf{Lcc}$ be an algebraically cofibrant strict lcc category.
  Denote by $\mathbf{Lcc}_{| \Gamma}$ the least covariant cwf of $\mathbf{Lcc}_{\Gamma /}$ that is full on types and terms.
  Then the category of contexts and cosubstitions of $\mathbf{Lcc}_{| \Gamma}$ is equivalent to $\Gamma^\mathrm{op}$.
\end{theorem}
\begin{proof}
  We construct a functor $H : \Gamma^\mathrm{op} \rightarrow \mathbf{Lcc}_{| \Gamma}$.
  We have $H(\sigma) = \Gamma.\sigma$.
  Let $f : \sigma \rightarrow \tau$ be a morphism in $\Gamma$.
  Then $f$ determines a morphism $1 \rightarrow \sigma^*(\tau)$ in $\Gamma_{/ \sigma}$ via the isomorphisms $1 \cong \mathrm{id}_\sigma$ and $\sigma^*(\tau) \cong \sigma \times \tau$.
  In turn, this morphism determines a term $\Gamma.\sigma \vdash f' : p_\sigma(\tau)$ via the equivalence $D_{\lambda, \tau} : \Gamma.\sigma \xrightarrow{\simeq} \Gamma_{/ \sigma}$.
  Now we let $H(f) = \langle p_\sigma, f' \rangle : \Gamma.\tau \rightarrow \Gamma.\sigma$.
  
  $\mathbf{Lcc}_{| \Gamma}$ is democratic by construction, thus $H$ is essentially surjective.
  \todo{
    Full + faithful follows from equivalences isos
    \begin{align}
      & \mathrm{Hom}(\sigma, \tau) \\
      \simeq {} & \mathrm{Hom}_\mathrm{Lcc}(\Gamma_{/ \tau} , \Gamma_{/ \sigma}) \\
      \simeq {} & \mathrm{Hom}_\mathrm{sLcc}(\Gamma.\tau, \Gamma.\sigma)
    \end{align}
    for cofibrant $\Gamma$, where the first and third Hom-categories are discrete and the middle one is only discrete up to equivalence.
    (The lcc and slcc functor categories have to be taken in category under $\Gamma$.)
  }
\end{proof}

By the Quillen equivalences $\mathrm{Lcc} \simeq \mathrm{sLcc} \simeq \mathbf{Lcc}$, every lcc category is equivalent to an algebraically cofibrant strict lcc category, i.e.\@ to a context in $\mathbf{Lcc}$, which by theorem \ref{th:context-as-model} is equivalent to a cwf supporting extensional ML type theory.

\section{Conclusion}

The main insight so far was that the coherence problems in interpretations of type theory can be solved by assuming a global point of view:
Instead of insisting on an interpretation in a given fixed lcc category, we interpret type theory in the category of all such categories, and theorem \ref{th:context-as-model} shows that we can recover from this single ``gros'' model a model in any fixed lcc category.
The main advantage of working globally is that we can use the machinery of model category theory, which works best for locally presentable categories.
While a given lcc category will often not be locally presentable, the category of all lcc categories is (at least when seen as a higher category).

\bibliographystyle{alpha}

\bibliography{main}

\end{document}
